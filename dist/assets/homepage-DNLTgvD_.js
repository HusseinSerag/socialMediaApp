import{u as C,a as I,c as A,r as x,j as e,I as y,M as g,C as N,b as P,d as b,A as E,e as S,B as v,f as F,_ as j,P as L}from"./index-BfS1IFI6.js";import{S as D}from"./SmallLoader-DtxKHsWe.js";function B(){const n=C(),{mutate:l,isPending:r}=I({mutationFn:A,onSuccess:()=>{n.invalidateQueries({queryKey:["posts"]})}});return{addPost:l,isPending:r}}function O({src:n,removeImage:l,index:r,getImageIndex:u,sortBefore:m}){const f=x.useRef();function h(){l(n)}return x.useEffect(function(){const i=f.current;function d(t){t.preventDefault(),t.stopPropagation();const a=t.dataTransfer.getData("text/plain"),s=u(a);m(s,r)}return i.addEventListener("drop",d),()=>i.removeEventListener("drop",d)},[r]),x.useEffect(function(){const i=f.current;function d(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.clearData(),t.dataTransfer.setData("text/plain",r)}return i.addEventListener("dragover",d),()=>i.removeEventListener("dragover",d)},[r]),e.jsxs("div",{className:"relative",draggable:!0,ref:f,children:[e.jsx("div",{className:"absolute cursor-pointer bg-red-500 ",children:e.jsx(y,{onClick:h,className:"h-[20px] w-[20px]"})}),e.jsx(g.Toggle,{opens:n,render:i=>e.jsx("div",{className:" h-[100px] w-[100px]",onClick:i,children:e.jsx("img",{src:n,className:"h-full w-full cursor-pointer object-cover"})})}),e.jsx(g.Content,{name:n,render:()=>e.jsx(N,{src:n})})]})}function R(){const[n,l]=x.useState([]),[r,u]=x.useState([]);function m(){u([]),l([])}function f(t){const a=t.target.files;l(a);const p=Array.from(a).map(o=>URL.createObjectURL(o));u(p)}function h(t){return r.findIndex(a=>a===t)}function i(t,a){if(t===a)return;const s=r[t],p=Array.from(n)[t],o=r.slice(),c=Array.from(n).slice();a===r.length-1?(o.splice(a+1,0,s),c.splice(a+1,0,p)):(o.splice(a,0,s),c.splice(a,0,p)),t<a?(o.splice(t,1),c.splice(t,1)):(o.splice(t+1,1),c.splice(t+1,1)),u(o),l(c)}function d(t){const a=r.findIndex(s=>s===t);a!==-1&&(console.log(a),l(s=>[...Array.from(s).filter((p,o)=>o!==a)]),u(s=>[...s.slice().filter((p,o)=>o!==a)]))}return{removeImage:d,sortBefore:i,getImageIndex:h,handleFileInputChange:f,preview:r,photos:n,reset:m}}function T(){const[n,l]=x.useState(""),{getImageIndex:r,handleFileInputChange:u,preview:m,removeImage:f,sortBefore:h,photos:i,reset:d}=R(),{addPost:t,isPending:a}=B(),{user:s}=P(),p=!!(s!=null&&s.id);function o(){if(p){if(n.length===0){j.error("Please write something first!");return}t({postOwner:s.id,postContent:n,photos:i},{onSuccess:()=>{l(""),d(),j.success("Post Added")}})}}return e.jsxs(b,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{name:s==null?void 0:s.username,size:"sm",avatar:s==null?void 0:s.profilePicture}),e.jsx("textarea",{placeholder:`What's on your mind ${s==null?void 0:s.username}?`,maxLength:S,value:n,onChange:c=>l(c.target.value),className:"dark:text-white h-18 grow resize-none  rounded-lg  p-3 text-sm placeholder:text-sm"})]}),m.length!==0&&e.jsx("div",{className:"my-4 flex flex-wrap gap-4",children:e.jsx(g,{children:m.map((c,w)=>e.jsx(O,{src:c,removeImage:f,index:w,getImageIndex:r,sortBefore:h},c))})}),e.jsxs("div",{className:"mt-2 flex items-center gap-5",children:[e.jsx("div",{children:e.jsx(v,{color:"",size:"",children:e.jsxs("label",{htmlFor:"file",className:"relative flex cursor-pointer gap-1 [&>svg]:h-5 [&>svg]:w-5",children:[e.jsx(F,{}),e.jsx("input",{type:"file",className:"absolute h-[1px] w-[1px] appearance-none",id:"file",multiple:!0,accept:"image/*",onChange:u}),"Photos"]})})}),e.jsx("div",{className:"ml-auto",children:e.jsx(v,{size:"",color:"",className:"rounded-md  bg-socialBlue px-6 py-1 text-white-A700",onClick:o,disabled:a,children:a?e.jsx(D,{}):"Share"})})]})]})}function M(){const{user:n}=P();return e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(e.Fragment,{children:e.jsx(L,{homepage:!0,user:n})})]})}export{M as default};
